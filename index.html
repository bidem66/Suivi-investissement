<!DOCTYPE html><html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Suivi investissement</title>
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({
        appId: "c5bd46ca-82c9-4493-b9a7-3813d3eccd03",
        safari_web_id: "web.onesignal.auto.21eb64f1-a307-4b53-9fa9-5af0b410a31b",
        notifyButton: { enable: true },
        subdomainName: "pushbidm"
      });
    });
  </script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background-color: #f9f9f9; color: #222; }
    h2 { margin-top: 30px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: center; }
    th { background-color: #f2f2f2; }
    .gain { color: green; }
    .perte { color: red; }
    .alerte { background: #ffe5e5; padding: 10px; color: darkred; font-weight: bold; margin-bottom: 20px; }
    .bouton { padding: 10px 20px; background: royalblue; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .bouton:hover { background: navy; }
    .actualisation { margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
    form { margin-top: 20px; }
    form input { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Suivi investissement</h1>  <div class="actualisation">
    <div>Prochaine mise à jour automatique dans 5 min</div>
    <button class="bouton" onclick="actualiserManuellement()">Actualiser maintenant</button>
  </div>  <!-- FORMULAIRE D'AJOUT D'ACTIF -->  <h2>Ajouter un actif</h2>
  <form onsubmit="ajouterActif(event)">
    <input type="text" id="symbol" placeholder="Symbole (ex: BTC ou AAPL)" required>
    <input type="number" id="quantite" step="any" placeholder="Quantité" required>
    <input type="number" id="investi" step="any" placeholder="Montant investi ($)" required>
    <button type="submit" class="bouton">Ajouter</button>
  </form>  <!-- FORMULAIRE DE SUPPRESSION D'ACTIF -->  <h2>Supprimer un actif</h2>
  <form onsubmit="supprimerActif(event)">
    <input type="text" id="symbolSupprimer" placeholder="Symbole (ex: BTC ou AAPL)" required>
    <button type="submit" class="bouton" style="background:red">Supprimer</button>
  </form>  <!-- ZONE POUR AJOUT DYNAMIQUE DES ACTIFS -->  <div id="zoneActifsAjoutes"></div>  <script>
    // Mise à jour automatique toutes les 5 minutes
    setInterval(() => {
      location.reload();
    }, 300000);

    function actualiserManuellement() {
      location.reload();
    }

    async function ajouterActif(event) {
      event.preventDefault();
      const symbole = document.getElementById('symbol').value.trim().toUpperCase();
      const quantite = parseFloat(document.getElementById('quantite').value);
      const investi = parseFloat(document.getElementById('investi').value);

      if (!symbole || isNaN(quantite) || isNaN(investi)) return;

      const isCrypto = /^[A-Z]{2,5}$/.test(symbole); // simple regex test
      let url, prix = 0;

      try {
        if (isCrypto) {
          url = `https://api.coingecko.com/api/v3/simple/price?ids=${symbole.toLowerCase()}&vs_currencies=cad`;
          const res = await fetch(url);
          const data = await res.json();
          prix = data[symbole.toLowerCase()].cad;
        } else {
          url = `https://query1.finance.yahoo.com/v7/finance/quote?symbols=${symbole}`;
          const res = await fetch(url);
          const data = await res.json();
          prix = data.quoteResponse.result[0].regularMarketPrice;
        }
        const valeur = (prix * quantite).toFixed(2);
        const variation = (valeur - investi).toFixed(2);
        const variationPct = ((variation / investi) * 100).toFixed(2);

        const ligne = `<table><tr><th>Symbole</th><th>Quantité</th><th>Investi</th><th>Prix unitaire</th><th>Valeur</th><th>Gain $</th><th>Gain %</th></tr>
<tr><td>${symbole}</td><td>${quantite}</td><td>${investi.toFixed(2)} $</td><td>${prix} ${isCrypto ? 'CAD' : 'USD'}</td><td>${valeur} $</td><td class="${variation >= 0 ? 'gain' : 'perte'}">${variation} $</td><td class="${variation >= 0 ? 'gain' : 'perte'}">${variationPct} %</td></tr></table>`;
        document.getElementById('zoneActifsAjoutes').innerHTML += ligne;
      } catch (e) {
        alert("Erreur lors de la récupération des données pour " + symbole);
      }
    }

    function supprimerActif(event) {
      event.preventDefault();
      const symbole = document.getElementById('symbolSupprimer').value.trim().toUpperCase();
      const zone = document.getElementById('zoneActifsAjoutes');
      const tables = zone.querySelectorAll('table');
      tables.forEach(table => {
        if (table.innerHTML.includes(symbole)) table.remove();
      });
    }
  </script></body>
</html>
